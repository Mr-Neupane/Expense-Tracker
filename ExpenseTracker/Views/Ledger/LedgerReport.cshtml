@model IEnumerable<ExpenseTracker.Dtos.LedgerReportDto>

@{
    ViewData["Title"] = "Ledger Report";
}

<h2 class="mt-3 mb-4 text-center font-weight-bold">Ledger Report</h2>
<style>
    .disabled-link {
        pointer-events: none;
        opacity: 0.6;
        cursor: not-allowed;

    }

</style>
<!-- Reverse button aligned to the right -->
<div class="d-flex justify-content-end mb-2">
    <form id="reverseForm" method="post">
        <input type="hidden" id="selectedIds" name="selectedIds"/>
        <button type="submit" id="reverseBtn" class="btn btn-danger" disabled>
            Reverse
        </button>
    </form>
</div>

<table class="table table-bordered table-striped table-hover" id="datatable" style="border-collapse:collapse">
    <thead class="bg-dark text-white text-center">
    <tr>
        <th style="width: 40px;">
            <!-- Optional: Select All checkbox -->
            <input type="checkbox" id="selectAll"/>
        </th>
        <th style="width: 50px;">SN</th>
        <th>COA</th>
        <th>Parent Name</th>
        <th>Ledger Code</th>
        <th>Ledger Name</th>
        <th>Status</th>
        <th>Created By</th>
        <th>Action</th>
    </tr>
    </thead>

    <tbody>
    @{
        int sn = 1;
    }

    @foreach (var item in Model)
    {
        <tr>
            <td class="text-center">
                <input type="checkbox" class="rowCheck"
                       value="@item.LedgerId"/>
            </td>

            <td class="text-center">@sn</td>

            <td>@item.CoaName</td>

            <td>@item.SubParentName</td>

            <td>@item.Code</td>

            <td>@item.LedgerName</td>

            <td class="@(item.Status == 1 ? "text-success" : "text-danger")">
                @(item.Status == 1 ? "Active" : "Inactive")
            </td>

            <td>@item.UserName</td>
            <td>
                @if (item.SubParentId != -2 && item.Status == 1)
                {
                    <a asp-route-ledgerId="@item.LedgerId" asp-action="EditLedger"
                       class="btn btn-primary btn-sm">Edit</a>
                }
                else
                {
                    <a asp-route-ledgerId="@item.LedgerId" asp-action="EditLedger"
                       class="btn btn-primary btn-sm disabled-link">Edit</a>
                }
                @if (item.SubParentId != -2)
                {
                    if (item.Status != 1)
                    {
                        <a asp-route-LedgerId="@item.LedgerId" asp-action="ActivateLedger"
                           class="btn btn-primary btn-sm"
                           onclick="return confirm('Do you want to activate this ledger')">Activate</a>
                    }
                    else
                    {
                        <a asp-route-LedgerId="@item.LedgerId" asp-action="DeactivateLedger"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Do you want to deactivate this ledger')">Deactivate</a>
                    }
                }
                else
                {
                    <a class="disabled-link btn-sm btn btn-secondary">No Action</a>
                }


            </td>
        </tr>

        sn++;
    }
    </tbody>
</table>


<script>
    const reverseBtn = document.getElementById("reverseBtn");
    const selectedIdsInput = document.getElementById("selectedIds");
    const selectAll = document.getElementById("selectAll");

    document.querySelectorAll(".rowCheck").forEach(cb => {
        cb.addEventListener("change", updateSelection);
    });

    selectAll.addEventListener("change", function () {
        const isChecked = this.checked;

        document.querySelectorAll(".rowCheck").forEach(cb => {
            cb.checked = isChecked;
        });

        updateSelection();
    });

    function updateSelection() {
        let selected = [];

        document.querySelectorAll(".rowCheck:checked").forEach(cb => {
            selected.push(cb.value);
        });

        selectedIdsInput.value = selected.join(",");
        reverseBtn.disabled = selected.length === 0;
    }
</script>
