@model IEnumerable<dynamic>

@{
    ViewData["Title"] = "Ledger Report";
}

<h2 class="mt-3 mb-4 text-center font-weight-bold">Ledger Report</h2>

<!-- Reverse button aligned to the right -->
<div class="d-flex justify-content-end mb-2">
    <form id="reverseForm"  method="post">
        <input type="hidden" id="selectedIds" name="selectedIds" />
        <button type="submit" id="reverseBtn" class="btn btn-danger" disabled>
            Reverse
        </button>
    </form>
</div>

<table class="table table-bordered table-striped table-hover" id="datatable">
    <thead class="bg-dark text-white text-center">
        <tr>
            <th style="width: 40px;">
                <!-- Optional: Select All checkbox -->
                <input type="checkbox" id="selectAll" />
            </th>
            <th style="width: 50px;">SN</th>
            <th>COA</th>
            <th>Parent Name</th>
            <th>Ledger Code</th>
            <th>Ledger Name</th>
            <th>Status</th>
            <th>Created By</th>
        </tr>
    </thead>

    <tbody>
        @{
            int sn = 1;
        }

        @foreach (var item in Model)
        {
            <tr>
                <td class="text-center">
                    <input type="checkbox" class="rowCheck"
                           value="@item.id" />
                </td>

                <td class="text-center">@sn</td>

                <td>@item.name</td>

                <td>@item.subparentname</td>

                <td>@item.code</td>

                <td>@item.ledgername</td>

                <td class="@(item.status == 1 ? "text-success" : "text-danger")">
                    @(item.status == 1 ? "Active" : "Inactive")
                </td>

                <td>@item.username</td>
            </tr>

            sn++;
        }
    </tbody>
</table>


<!-- JAVASCRIPT SECTION -->
<script>
    const reverseBtn = document.getElementById("reverseBtn");
    const selectedIdsInput = document.getElementById("selectedIds");
    const selectAll = document.getElementById("selectAll");

    // When any row checkbox is clicked
    document.querySelectorAll(".rowCheck").forEach(cb => {
        cb.addEventListener("change", updateSelection);
    });

    // Handle Select All checkbox
    selectAll.addEventListener("change", function () {
        const isChecked = this.checked;

        document.querySelectorAll(".rowCheck").forEach(cb => {
            cb.checked = isChecked;
        });

        updateSelection();
    });

    function updateSelection() {
        let selected = [];

        document.querySelectorAll(".rowCheck:checked").forEach(cb => {
            selected.push(cb.value);
        });

        selectedIdsInput.value = selected.join(",");

        // Enable button only if at least one is selected
        reverseBtn.disabled = selected.length === 0;
    }
</script>
